<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=../../../assets/logos/favicon.png><meta name=generator content="mkdocs-1.2.2, mkdocs-material-7.3.1"><title>Helm chart upgrade - Atlassian DC Helm Charts</title><link rel=stylesheet href=../../../assets/stylesheets/main.1c75ef36.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.3f5d1f46.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style><link rel=stylesheet href=../../../assets/stylesheets/extra.css><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-FZ7HCVNVPY"),document.addEventListener("DOMContentLoaded",function(){"undefined"!=typeof location$&&location$.subscribe(function(t){gtag("config","G-FZ7HCVNVPY",{page_path:t.pathname})})})</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-FZ7HCVNVPY"></script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary data-md-color-accent> <script>function __prefix(e){return new URL("../../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script> <script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#helm-chart-upgrade class=md-skip> Skip to content </a> </div> <div data-md-component=announce> <aside class="md-banner md-announce"> <div class="md-banner__inner md-announce__inner md-grid md-typeset"> <a href=https://community.atlassian.com/t5/Atlassian-Data-Center-on/gh-p/DC_Kubernetes title="Share your feedback with the Atlassian Data Center on Kubernetes Community" style=color:white><strong>Share your feedback and join the discussion</strong></a> </div> </aside> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title="Atlassian DC Helm Charts" class="md-header__button md-logo" aria-label="Atlassian DC Helm Charts" data-md-component=logo> <img src=../../../assets/logos/atlassian-logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Atlassian DC Helm Charts </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Helm chart upgrade </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary data-md-color-accent aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary data-md-color-accent aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/atlassian/data-center-helm-charts/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> atlassian/data-center-helm-charts </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../PREREQUISITES/ class="md-tabs__link md-tabs__link--active"> User guide </a> </li> <li class=md-tabs__item> <a href=../../../examples/EXAMPLES/ class=md-tabs__link> Examples </a> </li> <li class=md-tabs__item> <a href=../../../troubleshooting/TROUBLESHOOTING/ class=md-tabs__link> Troubleshooting </a> </li> <li class=md-tabs__item> <a href=../../../platforms/PLATFORMS/ class=md-tabs__link> Platforms </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title="Atlassian DC Helm Charts" class="md-nav__button md-logo" aria-label="Atlassian DC Helm Charts" data-md-component=logo> <img src=../../../assets/logos/atlassian-logo.svg alt=logo> </a> Atlassian DC Helm Charts </label> <div class=md-nav__source> <a href=https://github.com/atlassian/data-center-helm-charts/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> atlassian/data-center-helm-charts </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> Home </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2> User guide <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="User guide" data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> User guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../PREREQUISITES/ class=md-nav__link> Prerequisites </a> </li> <li class=md-nav__item> <a href=../../INSTALLATION/ class=md-nav__link> Installation </a> </li> <li class=md-nav__item> <a href=../../CONFIGURATION/ class=md-nav__link> Configuration </a> </li> <li class=md-nav__item> <a href=../../MIGRATION/ class=md-nav__link> Migration </a> </li> <li class=md-nav__item> <a href=../../OPERATION/ class=md-nav__link> Operation </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_6 type=checkbox id=__nav_2_6 checked> <label class=md-nav__link for=__nav_2_6> Upgrades <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Upgrades data-md-level=2> <label class=md-nav__title for=__nav_2_6> <span class="md-nav__icon md-icon"></span> Upgrades </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Helm chart upgrade <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Helm chart upgrade </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#1-find-the-current-version-of-the-installed-helm-chart class=md-nav__link> 1. Find the current version of the installed Helm chart </a> </li> <li class=md-nav__item> <a href=#2-define-the-target-helm-chart-version class=md-nav__link> 2. Define the target Helm chart version </a> </li> <li class=md-nav__item> <a href=#3-define-the-upgrade-method class=md-nav__link> 3. Define the upgrade method </a> </li> <li class=md-nav__item> <a href=#4-upgrade-the-helm-chart class=md-nav__link> 4. Upgrade the Helm chart </a> <nav class=md-nav aria-label="4. Upgrade the Helm chart"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#helm-chart-upgrade-with-downtime class=md-nav__link> Helm chart upgrade with downtime </a> </li> <li class=md-nav__item> <a href=#helm-chart-upgrade-with-zero-downtime class=md-nav__link> Helm chart upgrade with zero downtime </a> </li> <li class=md-nav__item> <a href=#helm-chart-upgrade-with-no-change-in-product-version class=md-nav__link> Helm chart upgrade with no change in product version </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../PRODUCTS_UPGRADE/ class=md-nav__link> Products upgrade </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_7 type=checkbox id=__nav_2_7> <label class=md-nav__link for=__nav_2_7> Resource management <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Resource management" data-md-level=2> <label class=md-nav__title for=__nav_2_7> <span class="md-nav__icon md-icon"></span> Resource management </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../resource_management/JIRA_INDEX_SNAPSHOT/ class=md-nav__link> Creating an initial index snapshot in Jira </a> </li> <li class=md-nav__item> <a href=../../resource_management/REQUESTS_AND_LIMITS/ class=md-nav__link> Resource requests and limits </a> </li> <li class=md-nav__item> <a href=../../resource_management/RESOURCE_SCALING/ class=md-nav__link> Product scaling </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> Examples <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Examples data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Examples </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../examples/EXAMPLES/ class=md-nav__link> Available examples </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2 type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2> Kubernetes cluster <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Kubernetes cluster" data-md-level=2> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> Kubernetes cluster </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../examples/cluster/AKS_SETUP/ class=md-nav__link> Preparing an AKS cluster </a> </li> <li class=md-nav__item> <a href=../../../examples/cluster/CLOUD_PROVIDERS/ class=md-nav__link> Provisioning Kubernetes clusters on cloud-based providers </a> </li> <li class=md-nav__item> <a href=../../../examples/cluster/EKS_SETUP/ class=md-nav__link> Preparing an EKS cluster </a> </li> <li class=md-nav__item> <a href=../../../examples/cluster/GKE_SETUP/ class=md-nav__link> Preparing an GKE cluster </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3 type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3> Database <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Database data-md-level=2> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> Database </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../examples/database/AMAZON_RDS/ class=md-nav__link> Creating an RDS database instance </a> </li> <li class=md-nav__item> <a href=../../../examples/database/CLOUD_PROVIDERS/ class=md-nav__link> Provisioning databases on cloud-based providers </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_4 type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4> Ingress <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Ingress data-md-level=2> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> Ingress </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../examples/ingress/CONTROLLERS/ class=md-nav__link> Provisioning an Ingress controller </a> </li> <li class=md-nav__item> <a href=../../../examples/ingress/DNS/ class=md-nav__link> Create DNS record via AWS CLI </a> </li> <li class=md-nav__item> <a href=../../../examples/ingress/INGRESS_NGINX/ class=md-nav__link> NGINX Ingress Controller - with TLS termination </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_5 type=checkbox id=__nav_3_5> <label class=md-nav__link for=__nav_3_5> Storage <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Storage data-md-level=2> <label class=md-nav__title for=__nav_3_5> <span class="md-nav__icon md-icon"></span> Storage </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../examples/storage/STORAGE/ class=md-nav__link> Shared storage </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_5_2 type=checkbox id=__nav_3_5_2> <label class=md-nav__link for=__nav_3_5_2> AWS <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=AWS data-md-level=3> <label class=md-nav__title for=__nav_3_5_2> <span class="md-nav__icon md-icon"></span> AWS </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../examples/storage/aws/LOCAL_STORAGE/ class=md-nav__link> Local storage </a> </li> <li class=md-nav__item> <a href=../../../examples/storage/aws/SHARED_STORAGE/ class=md-nav__link> Shared storage </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_5_3 type=checkbox id=__nav_3_5_3> <label class=md-nav__link for=__nav_3_5_3> NFS <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=NFS data-md-level=3> <label class=md-nav__title for=__nav_3_5_3> <span class="md-nav__icon md-icon"></span> NFS </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../examples/storage/nfs/NFS/ class=md-nav__link> NFS server for Bitbucket </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../examples/ssh/SSH_BITBUCKET/ class=md-nav__link> SSH service in Bitbucket on Kubernetes </a> </li> <li class=md-nav__item> <a href=../../../examples/elasticsearch/BITBUCKET_ELASTICSEARCH/ class=md-nav__link> Bitbucket Elasticsearch recommendations </a> </li> <li class=md-nav__item> <a href=../../../examples/logging/efk/EFK/ class=md-nav__link> Logging in a Kubernetes environment </a> </li> <li class=md-nav__item> <a href=../../../examples/external_libraries/EXTERNAL_LIBS/ class=md-nav__link> External libraries and plugins </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> Troubleshooting <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Troubleshooting data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Troubleshooting </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../troubleshooting/TROUBLESHOOTING/ class=md-nav__link> Troubleshooting tips </a> </li> <li class=md-nav__item> <a href=../../../troubleshooting/SUPPORT_BOUNDARIES/ class=md-nav__link> Support boundaries </a> </li> <li class=md-nav__item> <a href=../../../troubleshooting/LIMITATIONS/ class=md-nav__link> Limitations </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5> Platforms <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Platforms data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Platforms </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../platforms/PLATFORMS/ class=md-nav__link> Platform information </a> </li> <li class=md-nav__item> <a href=../../../platforms/OPENSHIFT/ class=md-nav__link> OpenShift </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#1-find-the-current-version-of-the-installed-helm-chart class=md-nav__link> 1. Find the current version of the installed Helm chart </a> </li> <li class=md-nav__item> <a href=#2-define-the-target-helm-chart-version class=md-nav__link> 2. Define the target Helm chart version </a> </li> <li class=md-nav__item> <a href=#3-define-the-upgrade-method class=md-nav__link> 3. Define the upgrade method </a> </li> <li class=md-nav__item> <a href=#4-upgrade-the-helm-chart class=md-nav__link> 4. Upgrade the Helm chart </a> <nav class=md-nav aria-label="4. Upgrade the Helm chart"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#helm-chart-upgrade-with-downtime class=md-nav__link> Helm chart upgrade with downtime </a> </li> <li class=md-nav__item> <a href=#helm-chart-upgrade-with-zero-downtime class=md-nav__link> Helm chart upgrade with zero downtime </a> </li> <li class=md-nav__item> <a href=#helm-chart-upgrade-with-no-change-in-product-version class=md-nav__link> Helm chart upgrade with no change in product version </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/atlassian/data-center-helm-charts/edit/main/docs/docs/userguide/upgrades/HELM_CHART_UPGRADE.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1 id=helm-chart-upgrade>Helm chart upgrade<a class=headerlink href=#helm-chart-upgrade title="Permanent link"> ¶</a></h1> <p>Each Helm chart has a default product version that might change in next Helm chart version. So be aware that if you upgrade the Helm chart, it might lead to upgrading the product as well. This depends on the current and target Helm chart versions. </p> <div class="admonition important"> <p class=admonition-title>Do you want to upgrade the product to a new version?</p> <p>If you want to upgrade the product version without upgrading the Helm chart then refer to <a href=../PRODUCTS_UPGRADE/ >Product upgrades</a>. </p> </div> <p>Before upgrading the Helm chart, first consider: </p> <ul> <li>the version of the current Helm chart</li> <li>the version of the product running on your Kubernetes cluster</li> <li>the target version of the Helm chart you want to upgrade to</li> <li>the target version of the product you want to upgrade to</li> </ul> <p>You need to know if the target product version is zero-downtime compatible (if it is subject to change). Based on this information you may need to choose a different upgrade method.</p> <div class="admonition info"> <p class=admonition-title>Upgrade product strategies</p> <p>There are two options for upgrade:</p> <ul> <li><em>Normal upgrade</em>: The service will have interruptions during the upgrade.</li> <li><em>Rolling upgrade</em>: The upgrade will proceed with zero downtime.</li> </ul> </div> <h2 id=1-find-the-current-version-of-the-installed-helm-chart>1. Find the current version of the installed Helm chart<a class=headerlink href=#1-find-the-current-version-of-the-installed-helm-chart title="Permanent link"> ¶</a></h2> <p>To find the current version of Helm chart and the product version run the following command:</p> <div class=highlight><pre><span></span><code>helm list --namespace &lt;namespace&gt; 
</code></pre></div> <p>You can see the current Helm chart tag version in the <code>CHART</code> column, and the current product tag version in the <code>APP VERSION</code> column for each release name. </p> <h2 id=2-define-the-target-helm-chart-version>2. Define the target Helm chart version<a class=headerlink href=#2-define-the-target-helm-chart-version title="Permanent link"> ¶</a></h2> <div class="admonition hint"> <p class=admonition-title>Do you have the Atlassian Helm chart repository locally?</p> <p>Make sure you have the Atlassian Helm chart repository in your local Helm repositories. Run the following command to add them:</p> <div class=highlight><pre><span></span><code>helm repo add atlassian-data-center <span class=se>\</span>
     https://atlassian.github.io/data-center-helm-charts
</code></pre></div> </div> <p>Update the Helm chart repository on your local Helm installation:</p> <div class=highlight><pre><span></span><code>helm repo update
</code></pre></div> <div class="admonition warning"> <p class=admonition-title>Target Helm chart version</p> <p>The target Helm chart version must be higher than the current Helm chart version.</p> </div> <p>To see all available Helm chart versions of the specific product run this command:</p> <div class=highlight><pre><span></span><code>helm search repo atlassian-data-center/&lt;product&gt; --versions
</code></pre></div> <p>Select the target Helm chart version. You can find the default application version (target product version tag) in the <code>APP VERSION</code> column.</p> <div class="admonition error"> <p class=admonition-title>Upgrading the Helm chart to a MAJOR version is not backward compatible.</p> <p>The Helm chart is <a href=https://semver.org/ class=external>semantically versioned</a>. You need to take some extra steps if you are upgrading the Helm chart to a MAJOR version. Before you proceed, learn about the steps for your target version in the <a href=../../..#upgrading>upgrading section</a>. </p> </div> <h2 id=3-define-the-upgrade-method>3. Define the upgrade method<a class=headerlink href=#3-define-the-upgrade-method title="Permanent link"> ¶</a></h2> <p>Considering the current and target <strong>product</strong> versions there are different scenarios: </p> <ol> <li>The versions are different, and the target product version is not zero-downtime compatible. </li> <li>The versions are different, and the target product version is zero-downtime compatible. </li> <li>The versions are the same.</li> </ol> <div class="admonition important"> <p class=admonition-title>See the following links to find out if two versions of a product are zero-downtime compatible</p> <p>Jira: <a class=external href=https://confluence.atlassian.com/adminjiraserver/upgrading-jira-data-center-with-zero-downtime-938846953.html>Upgrading Jira with zero downtime</a> <br> Confluence: <a class=external href=https://confluence.atlassian.com/doc/upgrade-confluence-without-downtime-1027127923.html>Upgrading Confluence with zero downtime</a><br> Bitbucket: <a class=external href=https://confluence.atlassian.com/bitbucketserver/upgrade-bitbucket-without-downtime-1038780379.html>Upgrading Bitbucket with zero downtime</a></p> </div> <div class="admonition note"> <p class=admonition-title>All supported Jira versions are zero-downtime compatible</p> <p>The minimum supported version of Jira in the Data Center Helm Charts is <code>8.19</code>. Considering any Jira version later than 8.x is zero-downtime compatible, all supported Jira Data Center versions are zero-downtime compatible. </p> </div> <p>Based on the scenario follow one of these options in the next step:</p> <ul> <li><strong>Normal upgrade</strong>: Upgrade Helm chart when the target product version is not zero-downtime compatible, or you want to avoid mixed version during the upgrade. In this option the product will have a downtime during the upgrade process. </li> <li><strong>Rolling upgrade</strong>: Upgrade Helm chart when the target product version is zero-downtime compatible. This option will only apply when the target product version is zero-downtime compatible. If you are not sure about this see the links above. </li> <li><strong>No product upgrade</strong>: Upgrade the Helm chart with no change in product version. We recommend this method when the target product version is the same as the current product version, or for any other reason you may not want to change the product version but still upgrade the helm chart. </li> </ul> <h2 id=4-upgrade-the-helm-chart>4. Upgrade the Helm chart<a class=headerlink href=#4-upgrade-the-helm-chart title="Permanent link"> ¶</a></h2> <div class="admonition hint"> <p class=admonition-title>Tip: Monitor the pods during the upgrade process</p> <p>You can monitor the pod activities during the upgrade by running the following command in a separate terminal: <div class=highlight><pre><span></span><code>kubectl get pods --namespace &lt;namespace&gt; --watch
</code></pre></div></p> </div> <div class=tabbed-set data-tabs=1:3><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><label for=__tabbed_1_1>Normal upgrade</label><div class=tabbed-content> <h3 id=helm-chart-upgrade-with-downtime>Helm chart upgrade with downtime<a class=headerlink href=#helm-chart-upgrade-with-downtime title="Permanent link"> ¶</a></h3> <p>You need to use this method to upgrade the Helm chart if: * the target product version is not zero downtime-compatible * for any other reason you would prefer to avoid running the cluster in mix mode</p> <div class="admonition warning"> <p class=admonition-title>Upgrading the Helm chart might change the product version</p> <p>If you want to upgrade the Helm chart to a newer version but don't want to change the product version then follow the <em>Upgrade with no change in product version</em> tab.</p> </div> <p>The strategy for upgrading the product with downtime is to scale down the cluster to zero nodes and then start the nodes with new product versions. And finally scale the cluster up to the original number of nodes. Here are step-by-step instructions for the upgrade process:</p> <ol> <li>Find out the number of nodes in the cluster. <div class=highlight><pre><span></span><code>kubectl describe sts &lt;release-name&gt; --namespace &lt;namespace&gt; <span class=p>|</span> grep <span class=s1>&#39;Replicas&#39;</span>
</code></pre></div></li> <li> <p>Upgrade the Helm chart.<br> Replace the product name in the following command: <div class=highlight><pre><span></span><code>helm upgrade &lt;release-name&gt; atlassian-data-center/&lt;product&gt; <span class=se>\</span>
 --version &lt;target-helm-chart-version&gt;&gt; <span class=se>\</span>
 --reuse-values <span class=se>\</span>
 --replicaCount<span class=o>=</span><span class=m>1</span> <span class=se>\</span>
 --wait <span class=se>\</span>
 --namespace &lt;namespace&gt;
</code></pre></div> The cluster will scale down to zero nodes. Then one pod with the target product version will be recreated and join the cluster. </p> </li> <li> <p>Scale up the cluster. After you confirm the new pod is in <code>Running</code> status then scale up the cluster to the same number of nodes as before the upgrade: <div class=highlight><pre><span></span><code>helm upgrade &lt;release-name&gt; atlassian-data-center/confluence <span class=se>\</span>
 --reuse-values <span class=se>\</span>
 --replicaCount<span class=o>=</span>&lt;n&gt; <span class=se>\</span>
 --wait <span class=se>\</span>
 --namespace &lt;namespace&gt;
</code></pre></div></p> </li> </ol> </div> <input id=__tabbed_1_2 name=__tabbed_1 type=radio><label for=__tabbed_1_2>Rolling upgrade</label><div class=tabbed-content> <h3 id=helm-chart-upgrade-with-zero-downtime>Helm chart upgrade with zero downtime<a class=headerlink href=#helm-chart-upgrade-with-zero-downtime title="Permanent link"> ¶</a></h3> <div class="admonition warning"> <p class=admonition-title>Upgrade the Helm chart might change the product version</p> <p>If you want to upgrade the Helm chart to newer version but don't want to change the product version then follow the <em>Upgrade with no change in product version</em> tab.</p> </div> <div class="admonition warning"> <p class=admonition-title>Rolling upgrade is not possible if the cluster has only one node</p> <p>If you have just one node in the cluster then you can't take advantage of the zero-downtime approach. You may scale up the cluster to at least two nodes before upgrading or there will be a downtime during the upgrade. </p> </div> <p>In order to upgrade the Helm chart when the target product version is different from the current product version, you can use upgrade with zero downtime to avoid any service interruption during the upgrade. To use this option the target version must be zero-downtime compatible. </p> <div class="admonition important"> <p class=admonition-title>Make sure the product target version is zero downtime-compatible</p> <p>To ensure you will have a smooth upgrade make sure the product target version is zero-downtime compatible. If you still aren't sure about this go back to step 3. </p> </div> <p>Here are the step-by-step instructions of the upgrade process. These steps may vary for each product:</p> <div class=tabbed-set data-tabs=2:3><input checked=checked id=__tabbed_2_1 name=__tabbed_2 type=radio><label for=__tabbed_2_1>Jira</label><div class=tabbed-content> <ol> <li> <p>Put Jira into upgrade mode. Go to <strong>Administration &gt; Applications &gt; Jira upgrades</strong> and click <strong>Put Jira into upgrade mode</strong>. <img alt=upgrade-mode src=../../../assets/images/jira-upgrade-1.png></p> </li> <li> <p>Run the upgrade using Helm. </p> <div class=highlight><pre><span></span><code>helm upgrade &lt;release-name&gt; atlassian-data-center/jira <span class=se>\</span>
 --version &lt;target-helm-chart-version&gt;&gt; <span class=se>\</span>
 --reuse-values <span class=se>\</span>
 --wait <span class=se>\</span>
 --namespace &lt;namespace&gt;
</code></pre></div> </li> <li> <p>Wait for the upgrade to finish. The pods will be recreated with the updated version, one at a time.</p> <p><img alt=upgrade-mode src=../../../assets/images/jira-upgrade-2.png></p> </li> <li> <p>Finalize the upgrade. After all the pods are active with the new version, click <strong>Run upgrade tasks</strong> to finalize the upgrade:</p> <p><img alt=upgrade-mode src=../../../assets/images/jira-upgrade-3.png></p> </li> </ol> </div> <input id=__tabbed_2_2 name=__tabbed_2 type=radio><label for=__tabbed_2_2>Confluence</label><div class=tabbed-content> <ol> <li> <p>Put Confluence into upgrade mode. From the admin page click on <em>Rolling Upgrade</em> and set the Confluence in Upgrade mode:</p> <p><img alt=upgrade-mode src=../../../assets/images/confluence-upgrade-1.png></p> </li> <li> <p>Run the upgrade using Helm. <div class=highlight><pre><span></span><code>helm upgrade &lt;release-name&gt; atlassian-data-center/confluence <span class=se>\</span>
    --version &lt;target-helm-chart-version&gt;&gt; <span class=se>\</span>
    --reuse-values <span class=se>\</span>
    --wait <span class=se>\</span>
    --namespace &lt;namespace&gt;
</code></pre></div> Wait until all pods are recreated and are back to <code>Running</code> status. </p> </li> <li> <p>Wait for the upgrade to finish. The pods will be recreated with the updated version, one at a time.</p> <p><img alt=upgrade-mode src=../../../assets/images/confluence-upgrade-2.png></p> </li> <li> <p>Finalize the upgrade. After all the pods are active with the new version, click <strong>Run upgrade tasks</strong> to finalize the upgrade:</p> <p><img alt=upgrade-mode src=../../../assets/images/confluence-upgrade-3.png></p> </li> </ol> </div> <input id=__tabbed_2_3 name=__tabbed_2 type=radio><label for=__tabbed_2_3>Bitbucket</label><div class=tabbed-content> <ol> <li> <p>Put Bitbucket into upgrade mode. From the admin page click on <em>Rolling Upgrade</em> and set the Bitbucket in Upgrade mode:</p> <p><img alt=upgrade-mode src=../../../assets/images/bitbucket-upgrade-1.png></p> </li> <li> <p>Run the upgrade using Helm. </p> <p><div class=highlight><pre><span></span><code>helm upgrade &lt;release-name&gt; atlassian-data-center/bitbucket <span class=se>\</span>
 --version &lt;target-helm-chart-version&gt;&gt; <span class=se>\</span>
 --reuse-values <span class=se>\</span>
 --wait <span class=se>\</span>
 --namespace &lt;namespace&gt;
</code></pre></div> Wait until all pods are recreated and are back to <code>Running</code> status. </p> </li> <li> <p>Wait for the upgrade to finish. The pods will be recreated with the updated version, one at a time.</p> <p><img alt=upgrade-mode src=../../../assets/images/bitbucket-upgrade-2.png></p> </li> <li> <p>Finalize the upgrade. After all the pods are active with the new version, click <strong>Run upgrade tasks</strong> to finalize the upgrade:</p> <p><img alt=upgrade-mode src=../../../assets/images/bitbucket-upgrade-3.png></p> </li> </ol> </div> </div> </div> <input id=__tabbed_1_3 name=__tabbed_1 type=radio><label for=__tabbed_1_3>Upgrade with no change in the product version</label><div class=tabbed-content> <h3 id=helm-chart-upgrade-with-no-change-in-product-version>Helm chart upgrade with no change in product version<a class=headerlink href=#helm-chart-upgrade-with-no-change-in-product-version title="Permanent link"> ¶</a></h3> <p>If your target Helm chart has a different product version in comparison with the current product version, and you still want to keep the current product version unchanged, you should use the following command to upgrade the Helm chart:</p> <div class=highlight><pre><span></span><code>helm upgrade &lt;release-name&gt; atlassian-data-center/&lt;product&gt; <span class=se>\</span>
    --version &lt;helm-chart-target-version&gt; <span class=se>\</span>
    --reuse-values <span class=se>\</span>
    --set image.tag<span class=o>=</span>&lt;current-product-tag&gt; <span class=se>\</span>
    --wait <span class=se>\</span>
    --namespace &lt;namespace&gt;
</code></pre></div> <p>However, when the product versions of target and current Helm charts are the same, then you can run the following command to upgrade the Helm chart only:</p> <div class=highlight><pre><span></span><code>helm upgrade &lt;release-name&gt; atlassian-data-center/&lt;product&gt; <span class=se>\</span>
     --version &lt;helm-chart-target-version&gt; <span class=se>\</span>
     --reuse-values <span class=se>\</span>
     --wait <span class=se>\</span>
     --namespace &lt;namespace&gt;
</code></pre></div> </div> </div> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../../OPERATION/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Operation" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Operation </div> </div> </a> <a href=../PRODUCTS_UPGRADE/ class="md-footer__link md-footer__link--next" aria-label="Next: Products upgrade" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Products upgrade </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; [2020] to [2021] Atlassian and others. </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-footer-social> <a href=https://community.atlassian.com/t5/Atlassian-Data-Center-on/gh-p/DC_Kubernetes target=_blank rel=noopener title=community.atlassian.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><path d="M152.2 236.4c-7.7-8.2-19.7-7.7-24.8 2.8L1.6 490.2c-5 10 2.4 21.7 13.4 21.7h175c5.8.1 11-3.2 13.4-8.4 37.9-77.8 15.1-196.3-51.2-267.1zM244.4 8.1c-122.3 193.4-8.5 348.6 65 495.5 2.5 5.1 7.7 8.4 13.4 8.4H497c11.2 0 18.4-11.8 13.4-21.7 0 0-234.5-470.6-240.4-482.3-5.3-10.6-18.8-10.8-25.6.1z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["search.suggest", "search.highlight", "navigation.instant", "navigation.tabs"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../assets/javascripts/workers/search.e99e714c.min.js", "version": null}</script> <script src=../../../assets/javascripts/bundle.c7d1b464.min.js></script> </body> </html>